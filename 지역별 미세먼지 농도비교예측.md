## 빅데이터 분석  (지역별 미세먼지 농도 분석 및 예측)

2019.04.22

R 3.5.2 

packages : psych 

library : xlsx , ggmap, ggplot2 , dplyr 



## 목차

### 1. 서론

	#### 1) 과제 개요 



### 2. 본론

#### 1) 과제 수행 내용

* 과제1 : 분석을 위한 파일 만들기

* 과제2 : 구별로 측정기간의 미세먼지 평균 농도 표 만들기

* 과제3 : 지도에 구별로 미세먼지 평균 농도를 표기하기

* 과제4 : 2개 구의 미세먼지 차이를 통계적으로 분석하기

* 과제5 : 인공 신경망을 이용하여 2개 구의 미세먼지 예측



### 3. 결론

#### 1) 프로젝트 결과

####  [별첨] : 전체 코드



### 1. 서론

* 과제 개요 : 지역별로 미세먼지 농도를 비교하고 예측해본다.
* 지도 API를 이용하여 지역별로 농도를 표기하고 미세먼지를 통계적으로 분석해본 후, 신경망을 이용해 미세먼지를 예측해본다.



### 2. 본론

#### [과제1] 분석을 위한 파일 만들기

- 서울 특별시 대기환경정보 웹사이트 접속`(http://cleanair.seoul.go.kr)`

  2017.09.01부터 17.12.31 사이의 대기 통계 검색

사진(R_1)

![image-20200804174943807](C:\Users\cjfgml123\AppData\Roaming\Typora\typora-user-images\R_1.png)



- 다운로드 데이터 전처리 사진(R_2)

  ![image-20200804175233599](C:\Users\cjfgml123\AppData\Roaming\Typora\typora-user-images\R_2.png)

  

#### [과제2] **구별로 측정기간의 미세먼지 평균 농도 표 만들기** 

```
#dustdata.xlsx파일을 R에 업로드, 열의 개수 3173개 확인
dustdata <- read.xlsx(file.choose(),1,encoding="UTF-8")
str(dustdata)
'data.frame':	3173 obs. of  3 variables:
 $ yyyymmdd: Factor w/ 123 levels "2017-09-01","2017-09-02",..: 123 122 122 122 122 122 122 122 122 122 ...
 $ area    : Factor w/ 26 levels "강남구","강동구",..: 26 26 23 24 21 16 6 11 25 17 ...
 $ finedust: num  38 63 54 53 60 62 63 69 67 60 ...

```



- 데이터에 NA로 되어있을 겨우 해결법은? 

1. 그대로 결측치를 처리한다.  

2.  평균치 삽입 – 결측치가 아닌 데이터의  평균값을 삽입한다.  

3.  보삽법 – 과거 몇 년간의 평균값을  기입한다.  

4.  평가치 추정법 – 계산된 공식에 따라  추정한다. 

   -> 다양한 방법들을 고려해 봤을 때, Excel 파일에  각 날짜별로 일일 평균값들이 제공되어 있으므로 2번의 방법을 채택하여 일별 단위 평균값으로 NA값을 채움  



```
#25개 구의 이름을 연속하여 벡터에 저장
#unique()함수로 중복된 값 제고, 1번행의 ‘평균’ 텍스트 제거([2:26])
area_name <- unique(dustdata$area)
area_name <- as.vector(area_name)
area_name <- area_name[2:26]; area_name
 [1] "종로구"   "중구"     "용산구"   "성동구"   "광진구"   "동대문구" "중랑구"   "성북구"  
 [9] "강북구"   "도봉구"   "노원구"   "은평구"   "서대문구" "마포구"   "양천구"   "강서구"  
[17] "구로구"   "금천구"   "영등포구" "동작구"   "관악구"   "서초구"   "강남구"   "송파구"  
[25] "강동구"
```



```
# 전체 평균 농도를 저장하는 데이터프레임 만들기
dd_area <- data.frame(area="전체평균", avg_fd=dustdata$finedust[1])
dd_area
      area avg_fd
1 전체평균     38
```



```
#반복문을 통해 25개 구 별로 구 이름과 농도 평균 저장
dust_vector = c()
 
for(i in 1:25){
    mean_dust <- dustdata[dustdata$area == area_name[i],]
    dust_vector[i] <- mean(mean_dust[,3])
    
 }
dust_vector
 [1] 35.53279 35.90984 33.74590 41.48361 36.54918 41.26230 35.63934 42.74590 34.01639 37.55738
[11] 40.10656 35.58197 38.72131 32.97541 42.09836       NA 39.72951 35.41803 44.77869 40.54918
[21] 35.54098 41.86885 35.68033 37.46721 42.18033

# rbind에서 컬럼 이름 맞추고, dust_vetcor 소수점 3자리 반올림
# 전체평균이 저장된 dd_area와 구별 평균 데이터프레임 rbind
area <- area_name
avg_fd <- round(dust_vector, digit=3)
bind_data <- cbind(area, avg_fd)
dd_area <- rbind(dd_area, bind_data)
d_area
       area avg_fd
1  전체평균     38
2    종로구 35.533
3      중구  35.91
4    용산구 33.746
```

- 정합성을 판단하기 위해 직접 종로구의 미세먼지 농도 평균을 계산 

(사진R_3)

![image-20200804175854098](C:\Users\cjfgml123\AppData\Roaming\Typora\typora-user-images\R_3.png)



#### [과제3] : 지도에 구별로 미세먼지 평균농도를 표기하기

```
#1. paste()함수로 구 앞에 seoul을 붙여줌
seoul <- "서울특별시"
addr <- c()

#좌표를 받아오기 위해 paste로 구앞에 서울특별시를 붙임
for(i in 1:25) {
 	addr[i] <- paste(seoul,dd_area[i+1,1])
}
addr;
 [1] "서울특별시 종로구"   "서울특별시 중구"     "서울특별시 용산구"   "서울특별시 성동구"  
 [5] "서울특별시 광진구"   "서울특별시 동대문구" "서울특별시 중랑구"   "서울특별시 성북구"  
 [9] "서울특별시 강북구"   "서울특별시 도봉구"   "서울특별시 노원구"   "서울특별시 은평구"  
[13] "서울특별시 서대문구" "서울특별시 마포구"   "서울특별시 양천구"   "서울특별시 강서구"  
[17] "서울특별시 구로구"   "서울특별시 금천구"   "서울특별시 영등포구" "서울특별시 동작구"  
[21] "서울특별시 관악구"   "서울특별시 서초구"   "서울특별시 강남구"   "서울특별시 송파구"  
[25] "서울특별시 강동구"
```



```
#2. 지도의 중심좌표를 서울로 놓고 1행에 삽입
gc <- geocode('seoul',source="google")
cen <- as.numeric(gc)
cen
[1] 126.97797  37.56654
```



```
#3. 각 구의 좌표를 받아 1행(중심좌표) 뒤에 연결
gc2 <- geocode(enc2utf8(addr), source ="google")
gc <- rbind(gc,gc2)
```



```
#4. 서울 맵 가져오기
map <- get_googlemap(center=cen, maptype="roadmap", zoom=11)
```



```
#5. 미세먼지 농도 평균값과 좌표 데이터 cbind 
#각 구별 마커와 데이터를 지도에 함께 출력
code_area_final <- cbind(dd_area, gc$lon,gc$lat)
colnames(code_area_final) <- c("area","avg_fd","lon","lat")

ggmap(map, extent="device") + geom_point(data=code_area_final,aes(x=lon, y=lat),color="red", size=3) + geom_text(data=code_area_final, aes(label=avg_fd,vjust=-1))
```



- 구 별 평균미세먼지 농도

사진 (R_4)

![image-20200804180250184](C:\Users\cjfgml123\AppData\Roaming\Typora\typora-user-images\R_4.png)

- 지도에서 누락되는 지역에 대해서는 어떻게 해결할 것인가?

  ㅡ 25개 구의 좌표를 올바르게 받아왔는데 지도에 출력이 되지 않는 이유는 기반이 되는 지도의 크기가 맞지 않기 때문이다. 따라서 다음 구문에서 

  map <- get_googlemap(center=cen, maptype="roadmap", zoom=12)

  zoom의 값을 11로 지정하면 map의 크키가 줄어들면서 25개의 구를 모두 표시할 수 있다.



#### [과제 4] 2개 구의 미세먼지 차이를 통계적으로 분석하기

```
# dplyr 라이브러리를 사용해 데이터 처리 간편화
# 구별 평균 농도 값에 대해 최대값과 최소값을 갖는 구 찾기
library(dplyr)
max<-max(dd_area$avg_fd)
min<-min(dd_area$avg_fd)
filter(dd_area,dd_area$avg_fd==max) #미세먼지농도가 최악인 구
	area avg_fd
1   영등포구 44.779
filter(dd_area,dd_area$avg_fd==min) #미세먼지농도가 최선인 구
	area avg_fd
1   마포구 32.975
```

ㅡ> 최악과 최선인 구가 각각 영등포구, 마포구임을 알 수 있음



```
# 미세분석을 위해 2개의 구 데이터만 발췌 및 NA 값이 없는지 확인
dustdata_anal<-filter(dustdata,dustdata$area=="영등포구"|dustdata$area=="마포구");
dustdata_anal
      yyyymmdd     area finedust
1   2017-12-31   마포구       63
2   2017-12-31 영등포구       70
3   2017-12-30   마포구      130
4   2017-12-30 영등포구      137
5   2017-12-29   마포구      102
6   2017-12-29 영등포구      107
7   2017-12-28   마포구       45
….
```



- 엑셀데이터의 필터링 후 결과 

(사진R_5)

![image-20200804180814177](C:\Users\cjfgml123\AppData\Roaming\Typora\typora-user-images\R_5.png)

ㅡ> 위와 데이터 개수, 값이 동일 



```
# 영등포구와 마포구를 분리하여 데이터프레임에 저장 
dda_area_yp <-filter(dustdata_anal,dustdata_anal$area=="영등포구"); dda_area_yp 
yyyymmdd     area finedust
1   2017-12-31 영등포구       70
2   2017-12-30 영등포구      137
3   2017-12-29 영등포구      107
4   2017-12-28 영등포구       50
…
dda_area_mp <-filter(dustdata_anal,dustdata_anal$area=="마포구"); dda_area_mp
yyyymmdd   area finedust
1   2017-12-31 마포구       63
2   2017-12-30 마포구      130
3   2017-12-29 마포구      102
4   2017-12-28 마포구       45
…
```



````
# 기초 통계량 분석 및 비교
# 왜도와 첨도를 구해주는 psych 라이브러리 사용
library(psych)
describe(dda_area_yp$finedust)
   vars   n  mean   sd median trimmed   mad min max range skew kurtosis   se
X1    1 122 44.78 20.6     42   42.54 17.79  12 137   125 1.51      3.9 1.87
describe(dda_area_mp$finedust)
   vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
X1    1 122 32.98 19.69     29   30.42 14.83   6 130   124 2.12     6.86 1.78
````

ㅡ> 개수, 평균, 표준편차, 중앙값, 절사 평균 등의 데이터 요약 제시



```
# boxplot 그래프 
boxplot(dda_area_yp$finedust, dda_area_mp$finedust,col=c("blue","green"),
main="미세먼지 비교",
xlab="area",
ylab="농도",
names=c("영등포구","마포구"))
```

- 영등포구, 마포구의 미세먼지 비교 box plot

(사진R_6)

![image-20200804181049459](C:\Users\cjfgml123\AppData\Roaming\Typora\typora-user-images\R_6.png)



```
# t검정을 통한 통계적 검정
t.test(data=dustdata_anal,finedust~area,var.equal=T)

	Two Sample t-test

data:  finedust by area
t = -4.5743, df = 242, p-value = 7.635e-06
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -16.886130  -6.720427
sample estimates:
  mean in group 마포구 mean in group 영등포구 
              32.97541               44.77869 
```

- t 검정을 통한 통계적 분석(해석)

귀무가설 H0 : “2개 구의 미세먼지는 차이가 없다.”

대립가설 H1 : “2개 구의 미세먼지는 차이가 있다.”

t-검정을 통해 95%의 신뢰수준 내에서 p-value값이 7.635e-06 = 0.000007635 이므로 유의 수준 값인 0.05보다 작다.

따라서, 귀무가설을 기각, 대립가설을 채택한다.

∴  95%의 신뢰구간 내에서 2개 구의 미세먼지는 차이가 있다.



#### [과제5] 인공 신경망을 이용하여 2개 구의 미세먼지 예측

```
# 데이터 전처리과정 
# 날짜를 오름차순으로 정렬
#영등포구 데이터
df1 <- data.frame(일자=dda_area_yp$yyyymmdd, 농도=dda_area_yp$finedust);
df1<- df1[seq(dim(df1)[1],1),]
head(df1)
          일자 농도
122 2017-09-01   31
121 2017-09-02   36
120 2017-09-03   40
119 2017-09-04   30
118 2017-09-05   30
117 2017-09-06   34

#마포구 데이터
df2 <- data.frame(일자=dda_area_mp$yyyymmdd, 농도=dda_area_mp$finedust);
df2 <- df2[seq(dim(df2)[1],1),]
head(df2)
          일자 농도
122 2017-09-01   20
121 2017-09-02   23
120 2017-09-03   29
119 2017-09-04   27
118 2017-09-05   21
117 2017-09-06   24
```



```

```

